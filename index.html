<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador Evidencia - Estructura Oficial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #444; margin-bottom: 20px; }
        
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #eee; border-radius: 8px; background: #fafafa; }
        .section-title { font-size: 0.9em; font-weight: bold; color: #666; margin-bottom: 10px; text-transform: uppercase; }
        
        label { display: block; margin-top: 10px; font-weight: 600; font-size: 0.9rem; }
        input[type="text"], input[type="date"] { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        
        .file-input-wrapper { display: flex; gap: 10px; align-items: center; margin-top: 5px; }
        input[type="file"] { font-size: 0.9rem; }

        .btn-generate { background-color: #0066cc; color: white; border: none; padding: 15px; width: 100%; font-size: 1.1rem; font-weight: bold; border-radius: 5px; cursor: pointer; margin-top: 20px; transition: background 0.3s; }
        .btn-generate:hover { background-color: #004c99; }

        .note { font-size: 0.8rem; color: #888; margin-top: 5px; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h2>Generador de Reporte - Formato Oficial</h2>

    <div class="section">
        <div class="section-title">1. Datos del Reporte</div>        <label>LUGAR Y FECHA:</label>
        <input type="text" id="fechaInput" value="18 DE SEPTIEMBRE DEL 2025">
        
        <label>SEDE:</label>
        <input type="text" id="sedeInput" value="UPN COLIMA">

        <label>FACILITADOR:</label>
        <input type="text" id="facilitadorInput" value="SOFÍA IVONE VILLASEÑOR RAMÍREZ">

        <label>NOMBRE DEL CURSO:</label>
        <input type="text" id="cursoInput" value="RESIGNIFICACIÓN DE LA FUNCIÓN DIRECTIVA Y DE SUPERVISIÓN HACÍA UN LIDERAZGO PEDAGÓGICO HACÍA UN TRABAJO HORIZONTAL">
    </div>

    <div class="section">
        <div class="section-title">2. Evidencia Fotográfica</div>
        <label>Seleccionar Fotos:</label>
        <input type="file" id="fotosInput" multiple accept="image/*">
        <p class="note">Se ajustarán automáticamente a 6cm de ancho con separación.</p>
    </div>

    <button class="btn-generate" onclick="generarPDF()">DESCARGAR PDF</button>
</div>

<script>
    // Textos fijos extraídos de tus documentos 
    const TEXTO_TITULO = "Acciones e Intervenciones de Formación del Programa para el Desarrollo Profesional Docente tipo Básico 2025.";
    const TEXTO_FOOTER_DIR = "Av. Gonzalo de Sandoval #760 Colonia Las Víboras C.P. 28040 Colima, Colima, México.";
    const TEXTO_FOOTER_CONTACTO = "312 31 61500, ext. 31940, 31958, 31945. www.secolima.gob.mx. E-mail: despacho.secretario@secolima.gob.mx";

    const readFile = (file) => new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.readAsDataURL(file);
    });

    // Función para cargar imágenes y obtener sus dimensiones
    const loadImage = (src) => {
        return new Promise((resolve, reject) => {
            const img = new Image();
            img.onload = () => resolve(img);
            img.onerror = reject;
            img.src = src;
        });
    };

    async function generarPDF() {
        const fecha = document.getElementById('fechaInput').value;
        const sede = document.getElementById('sedeInput').value;
        const facilitador = document.getElementById('facilitadorInput').value;
        const curso = document.getElementById('cursoInput').value;

        // Procesar fotos de evidencia
        const fotosFiles = document.getElementById('fotosInput').files;

        // Validar número máximo de imágenes para evitar desbordamiento
        if (fotosFiles.length > 6) {
            alert("Máximo 6 imágenes permitidas para evitar que salgan del espacio en el PDF.");
            return;
        }

        // Cargar imágenes de usuario
        const fotosBase64 = [];
        for (let i = 0; i < fotosFiles.length; i++) {
            const base64 = await readFile(fotosFiles[i]);
            fotosBase64.push(base64);
        }

        // Crear PDF usando jsPDF
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
            unit: 'pt',
            format: [612, 792],
            orientation: 'portrait'
        });

        // URLs de las imágenes del template
        const imgLogo1 = 'https://myfiles.space/user_files/temporary/692510cb9e0224.54677131/1764036810_sofi-a-villasen-or-s1-g1-resignificacio-n-de-la-funcio-n-directiv/1764036810_sofi-a-villasen-or-s1-g1-resignificacio-n-de-la-funcio-n-directiv-1.jpeg';
        const imgLogo2 = 'https://myfiles.space/user_files/temporary/692510cb9e0224.54677131/1764036810_sofi-a-villasen-or-s1-g1-resignificacio-n-de-la-funcio-n-directiv/1764036810_sofi-a-villasen-or-s1-g1-resignificacio-n-de-la-funcio-n-directiv-2.png';
        const imgLogo3 = 'https://myfiles.space/user_files/temporary/692510cb9e0224.54677131/1764036810_sofi-a-villasen-or-s1-g1-resignificacio-n-de-la-funcio-n-directiv/1764036810_sofi-a-villasen-or-s1-g1-resignificacio-n-de-la-funcio-n-directiv-3.png';

        try {
            // Cargar imágenes del template
            await loadImage(imgLogo1);
            await loadImage(imgLogo2);
            await loadImage(imgLogo3);

            // Agregar imagen de fondo/marco
            pdf.addImage(imgLogo1, 'JPEG', 4.5, 103.15, 602.25, 701.25);

            // Agregar logos del header
            pdf.addImage(imgLogo2, 'PNG', 21, 35.2, 492.44, 65.95);
            pdf.addImage(imgLogo3, 'PNG', 519.15, 41.8, 56.65, 56.65);

            // Agregar título principal
            pdf.setFontSize(10);
            pdf.setFont('helvetica', 'normal');
            pdf.text('Acciones e Intervenciones de Formación del ', 28.35, 127.4);
            pdf.setFont('helvetica', 'italic');
            pdf.text('Programa para el Desarrollo Profesional Docente tipo Básico 2025.', 250.58, 127.4);

            // Agregar rectángulo contenedor
            pdf.setDrawColor(0, 0, 0);
            pdf.setLineWidth(0.75);
            pdf.rect(28.78, 147.5, 554.45, 541.26);

            // Línea horizontal para separar header de contenido
            pdf.line(29.03, 266.41, 582.48, 266.41);

            // Agregar datos del curso
            pdf.setFont('helvetica', 'bold');
            pdf.setFontSize(10);
            pdf.text(`LUGAR Y FECHA: ${fecha.toUpperCase()}`, 34.78, 160.1);
            pdf.text(`SEDE: ${sede}`, 34.78, 191.84);
            pdf.text(`FACILITADOR: ${facilitador}`, 34.78, 204.05);

            // Manejar texto largo del curso con word wrap
            const cursoText = `NOMBRE DEL CURSO: ${curso}`;
            const splitCurso = pdf.splitTextToSize(cursoText, 540);
            pdf.text(splitCurso, 34.78, 225.79);

            // Título de evidencia fotográfica
            pdf.text('EVIDENCIA FOTOGRÁFICA:', 34.78, 273.51);

            // Agregar fotos de evidencia en grid 3x2
            if (fotosBase64.length > 0) {
                const imgWidth = 170;
                const imgHeight = 150;
                const marginX = 50;
                const marginY = 290;
                const spacingX = 10;
                const spacingY = 10;

                for (let i = 0; i < fotosBase64.length; i++) {
                    const col = i % 3;
                    const row = Math.floor(i / 3);
                    const x = marginX + (col * (imgWidth + spacingX));
                    const y = marginY + (row * (imgHeight + spacingY));

                    // Cargar y agregar imagen
                    const img = await loadImage(fotosBase64[i]);
                    const imgRatio = img.width / img.height;
                    let finalWidth = imgWidth;
                    let finalHeight = imgHeight;

                    // Ajustar dimensiones manteniendo aspecto
                    if (imgRatio > imgWidth / imgHeight) {
                        finalHeight = imgWidth / imgRatio;
                    } else {
                        finalWidth = imgHeight * imgRatio;
                    }

                    // Centrar imagen en su celda
                    const xOffset = (imgWidth - finalWidth) / 2;
                    const yOffset = (imgHeight - finalHeight) / 2;

                    pdf.addImage(fotosBase64[i], 'JPEG', x + xOffset, y + yOffset, finalWidth, finalHeight);
                }
            }

            // Agregar footer
            pdf.setFontSize(8);
            pdf.setFont('helvetica', 'normal');
            pdf.setTextColor(64, 64, 64);
            pdf.text('Av. Gonzalo de Sandoval #760 Colonia Las Víboras C.P. 28040 Colima, Colima, México.', 154.3, 762);
            pdf.text('312 31 61500, ext. 31940, 31958, 31945. www.secolima.gob.mx. E-mail: despacho.secretario@secolima.gob.mx', 117.86, 771.2);

            // Descargar PDF
            pdf.save('Evidencia_Oficial.pdf');

        } catch (error) {
            console.error('Error generando PDF:', error);
            alert('Error al generar el PDF. Verifica tu conexión a internet para cargar los logos.');
        }
    }
</script>

</body>
</html>